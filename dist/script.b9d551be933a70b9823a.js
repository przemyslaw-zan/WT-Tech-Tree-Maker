(()=>{"use strict";(()=>{function e(e){return`\n<!DOCTYPE html>\n<html lang="en">\n    <head>\n        <meta charset="UTF-8" />\n        <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n        <title>${e.title}</title>\n        <meta name="description" content="This tech tree was generated using WT-Tech-Tree-Maker." />\n        <meta name="generator" content="https://github.com/przemyslaw-zan/WT-Tech-Tree-Maker" />\n        <link rel="icon" href="https://warthunder.com/i/favicons/mstile-144x144.png" />\n        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />\n    </head>\n    <body>\n        <h1 style="text-align: center; border-bottom: 1px solid black; padding: 5px">${e.title}</h1>\n        <div style="max-width: 1000px; margin: auto; padding: 0 3px 0 3px">${e.description}</div>\n        <div id="techTreeWrapper">\n            <div id="techTree">${e.tree}</div>\n        </div>\n        <footer>\n            <div>\n                <a href="https://github.com/przemyslaw-zan/WT-Tech-Tree-Maker" target="_blank">\n                    <b>Github</b>\n                    <img src="https://raw.githubusercontent.com/przemyslaw-zan/WT-Tech-Tree-Maker/main/images/github.png">\n                </a>\n                <i>See source code</i>\n            </div>\n            <div>\n                <a href="https://www.reddit.com/user/zanju13" target="_blank">\n                    <b>Reddit</b>\n                    <img src="https://raw.githubusercontent.com/przemyslaw-zan/WT-Tech-Tree-Maker/main/images/reddit.png">\n                </a>\n                <i>Contact tool developer</i>\n            </div>\n            <div>\n                <a href="https://przemyslaw-zan.github.io/WT-Tech-Tree-Maker/" target="_blank">\n                    <b>Tool</b>\n                    <img src="https://raw.githubusercontent.com/przemyslaw-zan/WT-Tech-Tree-Maker/main/images/plus.png">\n                    \x3c!-- https://icons-for-free.com/create+new+plus+icon-1320183419213083922/ --\x3e\n                </a>\n                <i>Create your own tree</i>\n            </div>\n            <div>\n                <a href="https://zanju.neocities.org/" target="_blank">\n                    <b>Examples</b>\n                    <img src="https://raw.githubusercontent.com/przemyslaw-zan/WT-Tech-Tree-Maker/main/images/ribbon.png">\n                    \x3c!-- https://icons-for-free.com/ribbon+icon-1320087269980093187/ --\x3e\n                </a>\n                <i>See works of others</i>\n            </div>\n        </footer>\n        <div id="vehicleDisplayModal" class="modal">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <span class="close">&times;</span>\n                    <h2 id="modal_title"></h2>\n                </div>\n                <div class="modal-gallery">\n                    <div class="galleria" id="galleria"></div>\n                </div>\n                <div class="modal-body" id="modalDesc"></div>\n            </div>\n        </div>\n    </body>\n    <style>${e.styles}</style>\n    <script\n        src="https://code.jquery.com/jquery-3.5.1.js"\n        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="\n        crossorigin="anonymous"\n    ><\/script>\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"><\/script>\n    <script>\n        const vehicleList = ${e.vehicles}\n        const descriptionTemplate =\n        '<h3><em>Year:</em> <strong>XXXX</strong>&nbsp;<em>Development stage:</em>&nbsp;<strong>X</strong></h3>\\n\\n<p>Historical description...</p>\\n\\n<h3><em>Primary weapon:</em> <strong>X</strong></h3>\\n\\n<p>Primary weapon description...</p>\\n\\n<h3><em>Secondary weapon:</em> <strong>X</strong></h3>\\n\\n<p>Secondary weapon description...</p>\\n\\n<h3><em>Other info:</em></h3>\\n\\n<p>Crew, armor, mobility etc...</p>\\n\\n<h3><em>Proposed BR:</em> <strong>X.X</strong></h3>\\n\\n<p>Justification for Battle Rating placement...</p>\\n\\n<p><em>Links:</em></p>\\n\\n<ol>\\n\\t<li>Source 1...</li>\\n\\t<li>Source 2...</li>\\n\\t<li>WT forum discussion on the vehicle...</li>\\n</ol>\\n'\n        const settings = {\n            menuVisible: true,\n            screenshotMode: false,\n            thumbnailStyle: '0'\n        };\n\n        Galleria.loadTheme('https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/classic/galleria.classic.min.js')\n        Galleria.run('.galleria')\n        Galleria.configure({\n            _toggleInfo: false\n        })\n\n        document.querySelectorAll( '.close' ).forEach( ( item ) => {\n            item.addEventListener( 'click', closeModal );\n        } );\n        window.onclick = function (event) {\n            if (event.target.classList.contains('modal')) {\n                closeModal()\n            }\n        }\n\n        document.querySelector( '#techTree' ).addEventListener( 'click', techTreeClickProcessor );\n\n        ${e.functions.map((e=>e.toString())).join(";")}\n    <\/script>\n</html>\n`}(()=>{const t=[];let n={};const o="<h3><em>Year:</em> <strong>XXXX</strong>&nbsp;<em>Development stage:</em>&nbsp;<strong>X</strong></h3>\n\n<p>Historical description...</p>\n\n<h3><em>Primary weapon:</em> <strong>X</strong></h3>\n\n<p>Primary weapon description...</p>\n\n<h3><em>Secondary weapon:</em> <strong>X</strong></h3>\n\n<p>Secondary weapon description...</p>\n\n<h3><em>Other info:</em></h3>\n\n<p>Crew, armor, mobility etc...</p>\n\n<h3><em>Proposed BR:</em> <strong>X.X</strong></h3>\n\n<p>Justification for Battle Rating placement...</p>\n\n<p><em>Links:</em></p>\n\n<ol>\n\t<li>Source 1...</li>\n\t<li>Source 2...</li>\n\t<li>WT forum discussion on the vehicle...</li>\n</ol>\n",i=[{id:"none",name:"None",shapes:[{type:"line","stroke-width":"2",y2:"14",x2:"17",y1:"1",x1:"4",stroke:"#ff0000"},{type:"line","stroke-width":"2",y2:"14",x2:"4",y1:"1",x1:"17",stroke:"#ff0000"}]},{id:"lt",name:"Light Tank",shapes:[{type:"rect",height:"9",width:"21",y:"3",x:"0",fill:"#ffeeee"}]},{id:"mt",name:"Medium Tank",shapes:[{type:"rect",height:"9",width:"21",y:"3",x:"0",fill:"#ffaaaa"},{type:"rect",height:"4",width:"6",y:"11",x:"0",fill:"#ffaaaa"},{type:"rect",height:"4",width:"6",y:"11",x:"15",fill:"#ffaaaa"}]},{id:"ht",name:"Heavy Tank",shapes:[{type:"rect",height:"9",width:"21",y:"3",x:"0",fill:"#ff6666"},{type:"rect",height:"4",width:"6",y:"11",x:"0",fill:"#ff6666"},{type:"rect",height:"4",width:"6",y:"11",x:"15",fill:"#ff6666"},{type:"rect",height:"4",width:"7",y:"0",x:"7",fill:"#ff6666"}]},{id:"td",name:"Tank Destroyer",shapes:[{type:"rect",height:"5",width:"21",y:"10",x:"0",fill:"#bde9b5"},{type:"line",y2:"10",x2:"0",y1:"0",x1:"21","stroke-width":"3",stroke:"#bde9b5"}]},{id:"spaa",name:"Self Propelled Anti-Air",shapes:[{type:"rect",height:"5",width:"21",y:"10",x:"0",fill:"#c6a0ff"},{type:"rect",height:"11",width:"4",y:"0",x:"4",fill:"#c6a0ff"},{type:"rect",height:"11",width:"4",y:"0",x:"13",fill:"#c6a0ff"}]},{id:"fighter",name:"Fighter",shapes:[{type:"path",d:"m0,7.5l10.5,-7.5l10.5,7.5l-10.5,7.5l-10.5,-7.5z",fill:"#ffac6f"}]},{id:"attacker",name:"Attacker",shapes:[{type:"path",d:"m0,7.5l10.5,-5l10.5,5l-10.5,5l-10.5,-5z",fill:"#bde9b5"}]},{id:"bomber",name:"Bomber",shapes:[{type:"rect",height:"7.5",width:"21",y:"0",x:"0",fill:"#a3b1ff"},{type:"path",d:"m0,7.5l10.5,-7.5l10.5,7.5l-10.5,7.5l-10.5,-7.5z",fill:"#a3b1ff"}]},{id:"ahel",name:"Attack Helicopter",shapes:[{type:"path",d:"m0,7.5l10.5,-5l10.5,5l-10.5,5l-10.5,-5z",fill:"#f2f266"}]},{id:"uhel",name:"Utility Helicopter",shapes:[{type:"rect",height:"7.5",width:"21",y:"0",x:"0",fill:"#9bf266"},{type:"path",d:"m0,7.5l10.5,-7.5l10.5,7.5l-10.5,7.5l-10.5,-7.5z",fill:"#9bf266"}]},{id:"tboat",name:"Torpedo Boat",shapes:[{type:"path","stroke-width":"2",d:"M20 1L.75 7 20 13z",stroke:"#01d1de",fill:"none"}]},{id:"gboat",name:"Gun Boat",shapes:[{type:"path","stroke-width":"2",d:"M20 1L.75 7 20 13z",stroke:"#a3b1ff",fill:"#a3b1ff"}]},{id:"barge",name:"Barge",shapes:[{type:"path","stroke-width":"2",d:"M1 1h19v12H1z",stroke:"#f8cdae",fill:"none"}]},{id:"dd",name:"Frigate / Destroyer",shapes:[{type:"path","stroke-width":"2",d:"M20 1H7L.75 7 7 13h13z",stroke:"#f8a86d",fill:"none"}]},{id:"cl",name:"Light Cruiser",shapes:[{type:"path","stroke-width":"2",d:"M20 1H7L.75 7 7 13h13z",stroke:"#f8a6a6",fill:"none"},{type:"path","stroke-width":"2",d:"M15.75 1v12",stroke:"#f8a6a6"}]},{id:"ca",name:"Heavy Cruiser",shapes:[{type:"path","stroke-width":"2",d:"M20 1H7L.75 7 7 13h13z",stroke:"#ffaaaa",fill:"none"},{type:"path","stroke-width":"2",d:"M16 1H20v12h-4z",stroke:"#ffaaaa",fill:"#ffaaaa"}]},{id:"cc",name:"Battlecruiser",shapes:[{type:"path","stroke-width":"2",d:"M20 1H7L.75 7 7 13h13z",stroke:"#fda9a9",fill:"none"},{type:"path","stroke-width":"2",d:"M18 1H20v12h-2z",stroke:"#fda9a9",fill:"#ffaaaa"},{type:"path","stroke-width":"2",d:"M11 1H13v12h-2z",stroke:"#fda9a9",fill:"#ffaaaa"}]},{id:"bb",name:"Battleship",shapes:[{type:"path","stroke-width":"2",d:"M20 1H7L.75 7 7 13h13z",stroke:"#fd6565",fill:"none"},{type:"path","stroke-width":"2",d:"M16 1v12",stroke:"#fd6565"},{type:"path","stroke-width":"2",d:"M12 1v12",stroke:"#fd6565"},{type:"path","stroke-width":"2",d:"M8 1v12",stroke:"#fd6565"}]}];let r=!1;const l={menuVisible:!0,screenshotMode:!1,thumbnailStyle:"0",badgeStyle:"0"};function c(e){l.screenshotMode||document.querySelectorAll(".folderTooltipText").forEach((e=>{e.style.visibility="hidden"}));let n=e.target;for(;!/^v\d+$/.test(n.id);){if("techTree"===n.id)return;n=n.parentNode}const o=f(n);if(o)o.style.visibility="visible";else{const e=t.find((e=>e.id===n.id));if(!y(e))return;document.querySelector("#modal_title").innerText=e.name,e.images&&$(".galleria").data("galleria").load([...e.images]),document.querySelector("#modalDesc").innerHTML=e.description;const o=document.querySelector(".galleria-info");o.style.width="fit-content",o.style.left="auto",o.style.bottom="50px",o.style.top="auto",o.style.right="0px",document.querySelector(".galleria-info-text").style.backgroundColor="RGBA(0, 0, 0, 0.85)",document.querySelector(".galleria-info-text").style.padding="3px",document.querySelector("#vehicleDisplayModal").style.display="block",document.querySelector("body").style.overflow="hidden"}}function a(e){r=!1;const t={};for(const n of e){const e=["researchable","reserve"].includes(n.type)?n.branch:`premium_${n.branch}`,o=`rank_${n.rank}_branch_${e}`;void 0===t[o]&&(t[o]=[]),t[o].push(n)}for(const e in t){let n=t[e];n.sort(((e,t)=>e.br-t.br));const o=n.filter((e=>![void 0,"undefined"].includes(e.follow)));if(o.length>0){let e=0;for(;!d(n);){for(const e of o){if(-1===n.findIndex((t=>t.id===e.follow)))continue;n.splice(n.indexOf(e),1);const t=n.findIndex((t=>t.id===e.follow))+1;n.splice(t,0,e)}if(e++,e>1e3){console.log("infinite loop detected"),r=!0;break}}}const i=[...n];n=[];for(const e of i)if(0!==n.length)if("folder"!==e.connection)n.push(e);else{if(n[n.length-1].constructor===Array){n[n.length-1].push(e);continue}const t=n.pop();n.push([t,e])}else n.push(e);t[e]=n}if(!l.screenshotMode)return t;for(const e in t){const n=[];t[e].forEach(((e,t)=>{e.constructor===Array&&n.push({order:t+1,amount:e.length-1,branch:e[0].branch,rank:e[0].rank})})),n.sort(((e,t)=>t.order-e.order)).forEach(((n,o)=>{const i=[];for(let e=0;e<n.amount;e++){const t=`fake${n.rank}${n.branch}${o}${e}`;i.push({br:0,branch:n.branch,rank:n.rank,connection:"yes",type:"researchable",name:t,id:t})}t[e].splice(n.order,0,...i)}))}return t}function d(e){if(e=[...e],![void 0,"undefined"].includes(e[0].follow)&&e.some((t=>t.id===e[0].follow)))return!1;for(;e.length>=2;){if(![void 0,"undefined"].includes(e[1].follow)&&e[0].id!==e[1].follow)return!1;e.shift()}return!0}function s(e){document.querySelector("#techTree").innerHTML="";const t=[],o=[];for(const n in e){const e=Number(n.match(/_(\d+)_/)[1]);t.includes(e)||t.push(e);const i=n.match(/(?<=branch_).+$/gm)[0];o.includes(i)||o.push(i)}const i=Math.max(...t);for(let e=Math.min(...t);e<i;e++)t.includes(e)||t.push(e);t.sort(((e,t)=>Number(e)-Number(t))),o.sort();const r=document.querySelector("#techTree");r.innerHTML="";for(const n of t){let t=!0;const i=document.createElement("div");i.classList.add("rank");const l=document.createElement("div");l.classList.add("rankNumber");const c=document.createElement("div");c.innerHTML=`Rank <b>${u(n)}</b>`,c.classList.add("rankNumberText"),l.appendChild(c),i.appendChild(l);for(const r of o){const o=document.createElement("div");o.classList.add("branch"),-1!==r.indexOf("premium")&&t&&(t=!1,o.style.borderLeft="2px solid white");const l=`rank_${n}_branch_${r}`;if(void 0!==e[l])for(const t of e[l])t.constructor===Array?o.appendChild(p(t)):o.appendChild(m(t));const c=document.createElement("div");c.classList.add("fillerDiv"),c.classList.add(`badgeLine_${r}`),o.appendChild(c),i.appendChild(o)}r.appendChild(i)}document.querySelectorAll(".folderNumber").forEach((e=>{const t=document.createElement("div");t.innerText="+"+(e.innerText-1),t.classList.add("folderNumber"),e.parentNode.querySelector(".vehicleBadge").appendChild(t),e.remove()})),function(){const e=[];document.querySelectorAll(".vehicleBadge").forEach((t=>{const n=[...t.classList].find((e=>e.startsWith("badgeLine_")));e.includes(n)||e.push(n)}));for(const t of e){const e=[...document.querySelectorAll(`.${t}`)].filter((e=>!v(e))),n=[];if(e.forEach(((e,t)=>{e.classList.contains("vehicleBadge")&&n.push(t)})),n.length<2)continue;const o=n.shift(),i=n.pop(),r=e.slice(o+1,i+1),l=[];let c=[];r.forEach((e=>{e.classList.contains("vehicleBadge")?(e.classList.contains("connected_yes")&&l.push(c),c=[]):c.push(e)}));for(const e of l){for(;e.length>1;)e.shift().innerHTML+='<div class="lineDiv"></div>';e[0].innerHTML+='<div class="lineArrow"></div>'}}[...document.querySelectorAll(".folderTooltipText")].forEach((e=>{const t=[...e.querySelectorAll(".badgeLine")];for(let e=1;e<t.length-1;e++)t[e].innerHTML+=e%2==0?'<div class="lineArrow"></div>':'<div class="lineDiv"></div>'}))}(),document.querySelectorAll(".fillerDiv").forEach((e=>{const t=e.getBoundingClientRect().y,n=e.parentNode.getBoundingClientRect().y+e.parentNode.getBoundingClientRect().height;e.style.height=n-t+"px"})),[...document.querySelectorAll(".rank:first-child .branch")].forEach((e=>{const t=[...e.querySelectorAll("div")].map((e=>[...e.classList].find((e=>/badgeLine_/.test(e))))).find(Boolean).split("_").slice(1).join(" "),o=document.createElement("b");if(o.style.display="block",o.style.textAlign="center",o.style.padding="10px",o.innerText=`Branch: ${t}`,o.classList.add("branchHeaderBold"),o.dataset.branch=t,t.includes("premium")){const t=document.createElement("div");t.style.height="21px",t.classList.add("branchHeaderClear"),e.prepend(t)}else{const o=document.createElement("input");o.style.margin="auto",o.style.display="block",o.classList.add("branchHeaderClear"),o.id="branchHeaderInput"+t,n[o.id]&&(o.value=n[o.id]),e.prepend(o)}e.prepend(o)})),function(){const e=document.querySelector("#techTree").getBoundingClientRect().bottom,t=Math.max(...[...document.querySelectorAll(".folderTooltipText")].map((e=>e.getBoundingClientRect().bottom)))-e;if(t>0){const e=[...document.querySelectorAll(".rank")].pop(),n=e.getBoundingClientRect().height;e.style.height=`${n+t}px`}}(),l.screenshotMode&&(document.querySelectorAll(".folderTooltipText").forEach((e=>{e.style.visibility="visible"})),h())}function u(e){var t,n={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},o="";for(t in n)for(;e>=n[t];)o+=t,e-=n[t];return o}function h(){const e=[...document.querySelectorAll(".branchHeaderBold")];e.forEach((e=>{if(e.dataset.branch.includes("premium"))e.innerText="";else{const t=document.querySelector("#branchHeaderInput"+e.dataset.branch);e.innerText=t.value.replace(/\/\/\//g,"\n")}})),[...document.querySelectorAll(".branchHeaderClear")].forEach((e=>e.remove())),e.forEach((e=>e.style.padding="0px"));const t=Math.max(...e.map((e=>e.offsetHeight)));t&&e.forEach((e=>{e.style.height=`${t}px`,e.style.marginTop="5px"}))}function m(e){const t=document.createElement("div");let n="";const o={0:"max-height: 70%; max-width: 80%",1:"max-height: 100%; max-width: 100%",2:"height: 100%; width: 100%"}[l.thumbnailStyle];void 0!==e.thumbnail&&(n=`<img src="${e.thumbnail}" style="${o}">`);let r="";e.classIcon&&(r=g(i.find((t=>t.id===e.classIcon))));let c="";c="reserve"===e.type?`<i>Reserve</i> (${e.br.toFixed(1)})`:e.br.toFixed(1);let a="";return a=["researchable","reserve"].includes(e.type)?`badgeLine_${e.branch}`:`badgeLine_premium_${e.branch}`,t.innerHTML=`<table>\n<tbody>\n<tr>\n<td rowspan="3" class="badgeSide"></td>\n<td class="badgeLine ${a}"></td>\n<td rowspan="3" class="badgeSide"></td>\n</tr>\n<tr>\n<td id="${e.id}"\nclass="vehicleBadge type_${e.type} ${a}\nconnected_${e.connection}"\nstyle="position:relative; ${y(e)?"cursor:pointer;":""}">\n<span class="vehicleName">${e.name}</span>\n<b class="vehicleBr">${c}</b>\n${n}\n${r}\n</td>\n</tr>\n<tr>\n<td class="badgeLine ${a}"></td>\n</tr>\n</tbody>\n</table>`,"1"===l.badgeStyle&&t.classList.add("faithful"),t}function p(e){const t=document.createElement("div"),n=document.createElement("span"),o=document.createElement("div");o.classList.add("carpet"),n.appendChild(o),t.appendChild(m(e[0])),t.classList.add("folderTooltip"),n.classList.add("folderTooltipText");for(const t of e)n.appendChild(m(t));return t.innerHTML+=`<div class="folderNumber">${e.length}</div>`,t.appendChild(n),t}function y(e){const t=e.images?.length>0;return e.description?.length>0&&e.description!==o||t}function f(e){const t=e,n=[];for(;!e.classList.contains("folderTooltip");)if((e=e.parentNode).classList.contains("branch"))return!1;const o=e.querySelector(".folderTooltipText");for(const t of e.querySelectorAll("*"))t.id&&n.push(t);return!!t.isSameNode(n[0])&&o}function v(e){for(;"techTree"!==e.id;){if(e.classList.contains("folderTooltipText"))return!0;e=e.parentNode}return!1}function g(e){return`<svg width="21" height="15" xmlns="http://www.w3.org/2000/svg"><g>${e.shapes.map((e=>{const t=[];for(const n in e)"type"!==n&&t.push(`${n}="${e[n]}"`);return`<${e.type} ${t.join(" ")}/>`})).join()}</g></svg>`}function b(e){const t=[document.querySelector("#editionSelect"),document.querySelector("#vehicleFollow"),document.querySelector("#vehicleFollowEdit"),document.querySelector("#deleteVehicleSelect")];t.forEach((e=>{e.innerHTML=""}));const n=[];for(const t of e){const e=t.name,o=t.id;n.push({name:e,id:o})}n.sort(((e,t)=>e.name.localeCompare(t.name)));for(const e of t){e.innerHTML+='<option value="undefined">-- nothing selected --</option>';for(const t of n){const n=document.createElement("option");n.value=t.id,n.innerText=t.name,e.appendChild(n)}}}function S(){const e=document.querySelector("#vehicleOrderList");e.innerHTML="";const n=[],o=[];t.forEach((e=>{e.follow&&n.push(e)}));for(const i of n){const n=t.find((e=>e.id===i.follow));if(!n)return void(i.follow=void 0);o.push(n);const r=document.createElement("tr");r.innerHTML=`<td>${n.name}</td><td>➡️</td><td>${i.name}</td><th class="removeConnection">Remove this connection</th>`,r.id=i.id,e.appendChild(r)}o.forEach(((e,t,n)=>{n[t]=e.name}));const i=[];for(const e of o)i.includes(e)||o.indexOf(e)===o.lastIndexOf(e)||i.push(e);const l=document.querySelector("#followLoopWarning");if(l.style.display="none",document.querySelector("#navOrder").innerHTML="Vehicle ordering",document.querySelector("#multipleFollowWarning").innerHTML="",(r||i.length>0)&&(console.log("trigger #1"),document.querySelector("#navOrder").innerHTML='Vehicle ordering <b style="color:red;">WARNING!</b>'),r&&(console.log("trigger #2"),l.style.display="block"),i.length>0){console.log("trigger #3");const e=document.querySelector("#multipleFollowWarning");e.innerHTML+='<b style="color:red;">WARNING!</b> Following vehicles have more than one vehicle placed behind them:<br>';for(const t of i)e.innerHTML+=`<br>${t}`;e.innerHTML+="<br><br>This can cause problems with ordering, make sure each vehicle has no more than one follower."}}function w(e,t){const n=document.createElement("li"),o=document.createElement("table"),i=document.createElement("tbody"),r=document.createElement("tr"),l=document.createElement("td");l.rowSpan=2;const c=document.createElement("div");c.style.cursor="pointer",c.innerText="❌",l.appendChild(c),r.appendChild(l),c.addEventListener("click",(()=>{n.remove()}));const a=document.createElement("td"),d=document.createElement("div");d.style.cursor="pointer",d.innerText="⬆️",a.appendChild(d),r.appendChild(a),d.addEventListener("click",(()=>{n.previousSibling&&n.previousSibling.before(n)}));const s=document.createElement("td"),u=document.createElement("label");u.innerText="URL:",s.appendChild(u),r.appendChild(s);const h=document.createElement("td"),m=document.createElement("input");e&&(m.value=e),h.appendChild(m),r.appendChild(h);const p=document.createElement("td");p.rowSpan=2,p.style.padding=0;const y=document.createElement("img");e&&(y.src=e),y.height="50",p.appendChild(y),r.appendChild(p),m.addEventListener("change",(e=>{const t=e.target.value;y.src=t}));const f=document.createElement("tr"),v=document.createElement("td"),g=document.createElement("div");g.style.cursor="pointer",g.innerText="⬇️",v.appendChild(g),f.appendChild(v),g.addEventListener("click",(()=>{n.nextSibling&&n.nextSibling.after(n)}));const b=document.createElement("td"),S=document.createElement("label");S.innerText="Caption:",b.appendChild(S),f.appendChild(b);const w=document.createElement("td"),T=document.createElement("input");return t&&(T.value=t),w.appendChild(T),f.appendChild(w),i.appendChild(r),i.appendChild(f),o.appendChild(i),n.appendChild(o),n}function T(){document.querySelector("body").style.overflow="visible",document.querySelectorAll(".modal").forEach((e=>{e.style.display="none"})),$(".galleria").data("galleria").splice(0,$(".galleria").data("galleria").getDataLength()),$(".galleria").data("galleria").destroy(),Galleria.run(".galleria")}function E(e){const t=document.querySelector(e?"#vehicleClassIconsEdit":"#vehicleClassIcons");for(const n of i){const o=document.createElement("div");o.classList.add("tooltip");const i=document.createElement("span");i.classList.add("tooltipText"),i.innerText=n.name.replace(/\s/g," ").replace(/-/g,"‑"),i.style.width="fit-content",i.style.maxWidth="999px",i.style.padding="3px";const r=document.createElement("label");r.htmlFor=n.id+(e?"Edit":""),r.classList.add("classIconContainer");const l=document.createElement("input");l.type="radio",l.id=n.id+(e?"Edit":""),l.name="classIcons"+(e?"Edit":""),l.value=n.id,l.style.display="none","none"===l.id&&(l.checked=!0),r.appendChild(l),r.innerHTML+=g(n),o.appendChild(r),o.appendChild(i),t.appendChild(o),document.querySelector("#none"+(e?"Edit":"")).click()}}function k(){const e=document.querySelector("#navHide"),t=[...document.querySelectorAll("nav div")].filter((e=>"navHide"!==e.id));l.menuVisible?(e.innerText="Show Menu",t.forEach((e=>e.style.display="none"))):(e.innerText="Hide Menu",t.forEach((e=>e.style.display="block")))}!function(){Galleria.loadTheme("https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/classic/galleria.classic.min.js"),Galleria.run(".galleria"),Galleria.configure({_toggleInfo:!1}),$("#editionSelect").select2({width:"15em"}),$("#vehicleFollow").select2({width:"15em"}),$("#vehicleFollowEdit").select2({width:"15em"}),$("#deleteVehicleSelect").select2({width:"15em"}),CKEDITOR.config.height=350,CKEDITOR.replace("vehicleDescription"),CKEDITOR.replace("vehicleDescriptionEdit"),CKEDITOR.instances.vehicleDescription.setData(o),CKEDITOR.replace("techTreeMainDesc"),CKEDITOR.config.uiColor="#A4D0E6",E(!1),E(!0);const e=localStorage.getItem("branchTitles");e&&(n=JSON.parse(e));const i=localStorage.getItem("save");i&&(JSON.parse(i).forEach((e=>{t.push(e)})),b(t),S());const r=localStorage.getItem("title");r&&(document.querySelector("#techTreeName").value=r);const c=localStorage.getItem("description");c&&CKEDITOR.instances.techTreeMainDesc.setData(c);let d=localStorage.getItem("settings");d&&(d=JSON.parse(d),l.menuVisible=d.menuVisible??!0,l.screenshotMode=d.screenshotMode??!1,l.thumbnailStyle=d.thumbnailStyle??"0",l.badgeStyle=d.badgeStyle??"0",k(),document.querySelector('#settingsModal input[name="screenshotMode"]').checked=l.screenshotMode,document.querySelector(`input[name="thumbnailStyle"][value="${l.thumbnailStyle}"]`).checked=!0,document.querySelector(`input[name="badgeStyle"][value="${l.badgeStyle}"]`).checked=!0),s(a(t))}(),document.querySelector("#navAdd").addEventListener("click",(()=>{T(),document.querySelector("#addModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navEdit").addEventListener("click",(()=>{T(),document.querySelector("#editModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navDel").addEventListener("click",(()=>{T(),document.querySelector("#delModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navOrder").addEventListener("click",(()=>{T(),document.querySelector("#orderModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navBackup").addEventListener("click",(()=>{T(),document.querySelector("#backupModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navExport").addEventListener("click",(()=>{T(),document.querySelector("#exportModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navClone").addEventListener("click",(()=>{T(),document.querySelector("#cloneModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navSettings").addEventListener("click",(()=>{T(),document.querySelector("#settingsModal").style.display="block",document.querySelector("body").style.overflow="hidden"})),document.querySelector("#navHide").addEventListener("click",(()=>{l.menuVisible?l.menuVisible=!1:l.menuVisible=!0,localStorage.setItem("settings",JSON.stringify(l)),k()})),document.querySelectorAll(".close").forEach((e=>{e.addEventListener("click",T)})),window.onclick=function(e){e.target.classList.contains("modal")&&T()},document.querySelector("#addButton").addEventListener("click",(()=>{(function(){const e=document.querySelector("#vehicleName").value.trim();if(0===e.length)return window.alert("You have to provide name of the vehicle!"),!1;const n=Number(document.querySelector("#vehicleRank").value);if(!/^[0-9]{1,2}$/.test(n.toString())||0===n)return window.alert("Rank has to be a natural number between 1 and 99!"),!1;const i=Number(document.querySelector("#vehicleBr").value);if(!/^\d+\.\d$/.test(i)&&!/^\d+$/.test(i)||i<0||i>=100)return window.alert("Battle rating must have one or zero decimal places, and be a non-negative number less than 100!"),!1;const r=document.querySelector("#vehicleType").value,l=document.querySelector("#vehicleConnection").value,c=Number(document.querySelector("#vehicleBranch").value);if(!/^[1-9]$/.test(c.toString()))return window.alert("Branch has to be a natural number between 1 and 9!"),!1;let a=document.querySelector('input[name="classIcons"]:checked').value;"none"===a&&(a=void 0);const d=document.querySelector("#vehicleFollowEdit").value,s=CKEDITOR.instances.vehicleDescription.getData(),u="v"+Date.now(),h=document.querySelector("#vehicleThumbnail").value,m=[];document.querySelector("#vehicleImageList").querySelectorAll("li").forEach((e=>{const t=e.querySelectorAll("input")[0].value,n=e.querySelectorAll("input")[1].value.trim();t&&m.push({image:t,description:n})}));const p={name:e,rank:n,br:i,type:r,connection:l,branch:c,classIcon:a,follow:d,description:s,id:u,thumbnail:h,images:m};return t.push(p),document.querySelector("#newForm").reset(),document.querySelector("#none").checked=!0,CKEDITOR.instances.vehicleDescription.setData(o),T(),!0})()&&(localStorage.setItem("save",JSON.stringify(t)),b(t),s(a(t)),document.querySelector("#vehicleImageList").innerHTML="",S())})),document.querySelector("#vehicleImageListAdd").addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#vehicleImageList").appendChild(w())})),document.querySelector("#vehicleType").addEventListener("change",(e=>{const t=e.target.value,n=document.querySelector("#vehicleConnection");["researchable","reserve"].includes(t)?n.value="yes":n.value="no"})),document.querySelector("#editButton").addEventListener("click",(()=>{(function(){const e=document.querySelector("#vehicleNameEdit").value.trim();if(0===e.length)return window.alert("You have to provide name of the vehicle!"),!1;const n=Number(document.querySelector("#vehicleRankEdit").value);if(!/^[0-9]{1,2}$/.test(n.toString())||0===n)return window.alert("Rank has to be a natural number between 1 and 99!"),!1;const o=Number(document.querySelector("#vehicleBrEdit").value);if(!/^\d+\.\d$/.test(o)&&!/^\d+$/.test(o)||o<0||o>=100)return window.alert("Battle rating must have one or zero decimal places, and be a non-negative number less than 100!"),!1;const i=document.querySelector("#vehicleTypeEdit").value,r=document.querySelector("#vehicleConnectionEdit").value,l=Number(document.querySelector("#vehicleBranchEdit").value);if(!/^[1-9]$/.test(l.toString()))return window.alert("Branch has to be a natural number between 1 and 9!"),!1;let c=document.querySelector('input[name="classIconsEdit"]:checked').value;"none"===c&&(c=void 0);const a=document.querySelector("#vehicleFollowEdit").value,d=CKEDITOR.instances.vehicleDescriptionEdit.getData();CKEDITOR.instances.vehicleDescriptionEdit.setData("");const s=document.querySelector("#editionSelect").value,u=document.querySelector("#vehicleThumbnailEdit").value,h=[];document.querySelector("#vehicleImageListEdit").querySelectorAll("li").forEach((e=>{const t=e.querySelectorAll("input")[0].value,n=e.querySelectorAll("input")[1].value.trim();t&&h.push({image:t,description:n})}));const m={name:e,rank:n,br:o,type:i,connection:r,branch:l,classIcon:c,follow:a,description:d,id:s,thumbnail:u,images:h};return t.forEach(((e,t,n)=>{e.id===m.id&&(n[t]=m)})),document.querySelector("#editForm").reset(),document.querySelector("#noneEdit").checked=!0,T(),!0})()&&(localStorage.setItem("save",JSON.stringify(t)),b(t),s(a(t)),document.querySelector("#vehicleImageListEdit").innerHTML="",S())})),$("#editionSelect").on("change",(e=>{if("undefined"===e.target.value)return;document.querySelector("#vehicleImageListEdit").innerHTML="";const n=e.target.value,o=t.find((e=>e.id===n));if(document.querySelector("#vehicleNameEdit").value=o.name,document.querySelector("#vehicleRankEdit").value=o.rank,document.querySelector("#vehicleBrEdit").value=o.br,document.querySelector("#vehicleTypeEdit").value=o.type,document.querySelector("#vehicleConnectionEdit").value=o.connection,document.querySelector("#vehicleBranchEdit").value=o.branch,document.querySelector("#vehicleFollowEdit").value=o.follow,CKEDITOR.instances.vehicleDescriptionEdit.setData(o.description),document.querySelector("#vehicleThumbnailEdit").value=o.thumbnail,o.images){const e=document.querySelector("#vehicleImageListEdit");for(const t of o.images){const n=t.image?t.image:"",o=t.description?t.description:"";e.appendChild(w(n,o))}}o.classIcon?document.querySelector(`#${o.classIcon}Edit`).click():document.querySelector("#noneEdit").click()})),document.querySelector("#vehicleImageListEditAdd").addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#vehicleImageListEdit").appendChild(w())})),document.querySelector("#vehicleTypeEdit").addEventListener("change",(e=>{const t=e.target.value,n=document.querySelector("#vehicleConnectionEdit");["researchable","reserve"].includes(t)?n.value="yes":n.value="no"})),$("#deleteVehicleSelect").on("change",(e=>{if("undefined"===e.target.value)return;const n=t.find((t=>t.id===e.target.value)),o=document.querySelector("#vehicleDeleteDisplay");o.innerHTML="",o.appendChild(m(n))})),document.querySelector("#deleteVehicleButton").addEventListener("click",(()=>{const e=document.querySelector("#deleteVehicleSelect").value;if("undefined"===e)return;const n=t.find((t=>t.id===e)).name;if(!0===confirm(`Do you want to delete ${n}?`)){const n=[];t.forEach((t=>{t.id!==e&&n.push(t)})),t.splice(0,t.length),n.forEach((e=>t.push(e))),localStorage.setItem("save",JSON.stringify(t)),b(t),document.querySelector("#vehicleDeleteDisplay").innerHTML="",s(a(t)),S()}})),document.querySelector("#deleteAllButton").addEventListener("click",(()=>{!0===confirm("Do you want to delete ALL VEHICLES, tech tree name and it's description? This is irreversible!")&&(n={},t.splice(0,t.length),document.querySelector("#techTreeName").value="",CKEDITOR.instances.techTreeMainDesc.setData(""),localStorage.clear(),s(a(t)),T(),S())})),document.querySelector("#vehicleOrderList").addEventListener("click",(e=>{if(e.target.classList.contains("removeConnection")){const n=e.target.parentNode.id,o=t.findIndex((e=>e.id===n));t[o].follow=void 0,localStorage.setItem("save",JSON.stringify(t)),s(a(t)),S()}})),document.querySelector("#backupDownload").addEventListener("click",(()=>{const e=document.querySelector("#techTreeName").value,o={title:e,description:CKEDITOR.instances.techTreeMainDesc.getData(),vehicleList:t,branchTitles:n,settings:l},i=e.toLowerCase().trim().replaceAll(" ","_")+"_backup.json";var r=new Blob([JSON.stringify(o)],{type:"application/json"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,i);else{var c=document.createElement("a"),a=URL.createObjectURL(r);c.href=a,c.download=i,document.body.appendChild(c),c.click(),setTimeout((function(){document.body.removeChild(c),window.URL.revokeObjectURL(a)}),0)}})),document.querySelector("#loadBackup").addEventListener("click",(()=>{const e=document.querySelector("#backupUpload").files[0];e&&e.text().then((e=>{try{const o=JSON.parse(e);if([o.title,o.description,o.vehicleList].includes(void 0))return void window.alert("Incorrect save file! Make sure you upload correct save file!");!0===confirm("Do you want to load data from save file? This will override all current data, if you work on multiple trees, make sure to backup them first!")&&(o.branchTitles?(localStorage.setItem("branchTitles",JSON.stringify(o.branchTitles)),n=o.branchTitles):(localStorage.removeItem("branchTitles"),n={}),o.settings?(l.menuVisible=o.settings.menuVisible??!0,l.screenshotMode=o.settings.screenshotMode??!1,l.thumbnailStyle=o.settings.thumbnailStyle??"0",l.badgeStyle=o.settings.badgeStyle??"0",k(),document.querySelector('#settingsModal input[name="screenshotMode"]').checked=l.screenshotMode,document.querySelector(`input[name="thumbnailStyle"][value="${l.thumbnailStyle}"]`).checked=!0,document.querySelector(`input[name="badgeStyle"][value="${l.badgeStyle}"]`).checked=!0):(l.menuVisible=!0,l.screenshotMode=!1,l.thumbnailStyle="0",l.badgeStyle="0"),localStorage.setItem("settings",JSON.stringify(l)),document.querySelector("#techTreeName").value=o.title,CKEDITOR.instances.techTreeMainDesc.setData(o.description),t.splice(0,t.length),o.vehicleList.forEach((e=>{t.push(e)})),b(t),s(a(t)),S(),localStorage.setItem("title",o.title),localStorage.setItem("description",o.description),localStorage.setItem("save",JSON.stringify(t)),T())}catch(e){window.alert(`An error occurred:\n\n${e}\n\nMake sure you upload correct save file!`)}}))})),document.querySelector("#exportTechTreeButton").addEventListener("click",(()=>{l.screenshotMode&&(l.screenshotMode=!1,s(a(t)),l.screenshotMode=!0);const n=document.querySelector("#techTreeName").value,o=CKEDITOR.instances.techTreeMainDesc.getData();h();const i={title:n,description:o,tree:document.querySelector("#techTree").innerHTML,vehicles:JSON.stringify(t),styles:[...[...document.styleSheets].find((e=>"WT_TECH_TREE_MAKER_STYLES"===e.title)).cssRules].map((e=>e.cssText)).join(""),functions:[c,f,y,T]};s(a(t));const r=new Blob([e(i)]),d=n.toLowerCase().trim().replaceAll(" ","_")+".html";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,d);else{const e=document.createElement("a"),t=URL.createObjectURL(r);e.href=t,e.download=d,document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}})),document.querySelector("#copyCloneUtility").addEventListener("click",(()=>{navigator.clipboard.writeText("\n\t\tresBranches = Number( document.querySelectorAll( '.tree th' )[ 1 ].getAttribute( 'colspan' ) || 0 );\n\t\ti = 0;\n\t\tvehicleList = [ ...document.querySelectorAll( '.tree-item' ) ].map( node => {\n\t\t\tconst vehicle = {};\n\t\t\n\t\t\ti++;\n\t\t\tvehicle.id = 'v' + i;\n\t\t\n\t\t\tvehicle.name = node.innerText;\n\t\t\n\t\t\tvehicle.thumbnail = node.querySelector( '.tree-item-img img' )?.src;\n\t\t\n\t\t\tvehicle.type = node.querySelector( '.tree-item-background img' ).src.match( /_([^\\/]+)\\.png/ )[ 1 ];\n\t\t\n\t\t\tswitch ( vehicle.type ) {\n\t\t\tcase 'own':\n\t\t\t\tvehicle.type = 'researchable';\n\t\t\t\tbreak;\n\t\t\tcase 'prem':\n\t\t\t\tvehicle.type = 'premium';\n\t\t\t\tbreak;\n\t\t\tcase 'squad':\n\t\t\t\tvehicle.type = 'squadron';\n\t\t\t}\n\t\t\n\t\t\tconst parentNode = node.parentNode;\n\t\t\tif ( parentNode.classList.contains( 'tree-group-collapse' ) ) {\n\t\t\t\tif ( [ ...parentNode.querySelectorAll( '.tree-item' ) ][ 0 ].innerText === vehicle.name ) {\n\t\t\t\t\tvehicle.connection = 'first';\n\t\t\t\t} else {\n\t\t\t\t\tvehicle.connection = 'folder';\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\twhile ( node.tagName !== 'TD' ) {\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t\tnode = node.parentNode;\n\t\t\n\t\t\tvehicle.branch = [ ...node.querySelectorAll( 'td' ) ].findIndex( td => {\n\t\t\t\tconst vehiclesInBranch = [ ...td.querySelectorAll( '.tree-item' ) ].map( vehicle => vehicle.innerText );\n\t\t\t\treturn vehiclesInBranch.includes( vehicle.name );\n\t\t\t} ) + 1;\n\t\t\n\t\t\tif ( vehicle.branch > resBranches ) {\n\t\t\t\tvehicle.branch = vehicle.branch - resBranches;\n\t\t\t\tif ( vehicle.type === 'researchable' ) {\n\t\t\t\t\tvehicle.type = 'event';\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tnode = node.parentNode;\n\t\t\n\t\t\tvehicle.rank = [ ...node.querySelectorAll( 'tr' ) ].findIndex( tr => {\n\t\t\t\tconst vehiclesInRank = [ ...tr.querySelectorAll( '.tree-item' ) ].map( vehicle => vehicle.innerText );\n\t\t\t\treturn vehiclesInRank.includes( vehicle.name );\n\t\t\t} );\n\t\t\n\t\t\tvehicle.br = 0;\n\t\t\n\t\t\tif ( vehicle.connection !== 'folder' ) {\n\t\t\t\tvehicle.connection = 'yes';\n\t\t\t}\n\t\t\tif ( vehicle.type !== 'researchable' ) {\n\t\t\t\tvehicle.connection = 'no';\n\t\t\t}\n\t\t\tvehicle.name = vehicle.name.trim().replace( /\\s/g, '\\u0020' )\n\t\t\t\t.replace( /[^\\x00-\\xFF]/g, '\\u002a' );\n\t\t\n\t\t\treturn vehicle;\n\t\t} );\n\t\ttitle = document.querySelector( '#firstHeading' ).innerText;\n\t\tdescription = 'This tech tree was cloned from the WT wiki on ' + new Date();\n\t\t\n\t\tcontent = {\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tvehicleList\n\t\t};\n\t\tfileName = title.toLowerCase().trim()\n\t\t\t.replaceAll( ' ', '_' ) + '_backup.json';\n\t\tfile = new Blob( [ JSON.stringify( content ) ], {\n\t\t\ttype: 'application/json'\n\t\t} );\n\t\tif ( window.navigator.msSaveOrOpenBlob ) window.navigator.msSaveOrOpenBlob( file, fileName );\n\t\telse {\n\t\t\tvar a = document.createElement( 'a' ),\n\t\t\t\turl = URL.createObjectURL( file );\n\t\t\ta.href = url;\n\t\t\ta.download = fileName;\n\t\t\tdocument.body.appendChild( a );\n\t\t\ta.click();\n\t\t\tsetTimeout( function () {\n\t\t\t\tdocument.body.removeChild( a );\n\t\t\t\twindow.URL.revokeObjectURL( url );\n\t\t\t}, 0 );\n\t\t}\n\t\t").then((()=>{alert("Successfully copied the utility!")})).catch((e=>{alert("Error during copying: ",e)}))})),document.querySelector("#settingsModal").addEventListener("change",(()=>{l.screenshotMode=document.querySelector('#settingsModal input[name="screenshotMode"]').checked,l.thumbnailStyle=document.querySelector('input[name="thumbnailStyle"]:checked').value,l.badgeStyle=document.querySelector('input[name="badgeStyle"]:checked').value,localStorage.setItem("settings",JSON.stringify(l)),s(a(t))})),document.querySelector("#techTree").addEventListener("click",c),document.querySelector("#techTree").addEventListener("input",(e=>{const t=e.target;t.id.startsWith("branchHeaderInput")&&(n[t.id]=t.value,localStorage.setItem("branchTitles",JSON.stringify(n)))})),document.querySelector("#techTreeName").addEventListener("change",(e=>{localStorage.setItem("title",e.target.value)})),CKEDITOR.instances.techTreeMainDesc.on("change",(()=>{localStorage.setItem("description",CKEDITOR.instances.techTreeMainDesc.getData())})),CKEDITOR.on("dialogDefinition",(function(e){const t=e.data.name,n=e.data.definition;"link"==t&&(n.getContents("info").get("protocol").default="https://",n.getContents("target").get("linkTargetType").default="_blank")})),CKEDITOR.on("instanceReady",(function(e){e.editor.document.getBody().setStyle("background-color","rgb(36, 46, 51)"),e.editor.document.getBody().setStyle("color","white"),e.editor.on("contentDom",(function(){e.editor.document.getBody().setStyle("background-color","rgb(36, 46, 51)"),e.editor.document.getBody().setStyle("color","white")}))})),window.onbeforeunload=()=>"Do you really want to leave this page?"})()})()})();